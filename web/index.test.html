<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Server</title>
    <style>
        :root{--cd:#3B82F6;--ca:#EC4899;--ci:#10B981;--cu:#6B7280;--cs:#8B5CF6;--cp:#EF4444;--cg:#000;--bg:#f9fafb;--bd:#e5e7eb;--tx:#374151;--mt:#6b7280}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f3f4f6;color:#111827}
        .c{max-width:1200px;margin:0 auto;padding:20px}
        .h{text-align:center;margin-bottom:30px}.h h1{color:#1f2937;margin-bottom:10px}.h p{color:#6b7280}
        .t{display:flex;background:#fff;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,.1);margin-bottom:20px}
        .tab{flex:1;padding:15px;text-align:center;cursor:pointer;border-bottom:3px solid transparent;transition:all .2s}
        .tab.active{border-bottom-color:var(--cd);color:var(--cd);font-weight:600}.tab:hover:not(.active){background:var(--bg)}
        .p{display:none;background:#fff;border-radius:8px;padding:25px;box-shadow:0 1px 3px rgba(0,0,0,.1)}.p.active{display:block}
        .f{margin-bottom:20px}.f label{display:block;margin-bottom:8px;font-weight:500;color:var(--tx)}
        .f input,.f select{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px}
        .f input:focus,.f select:focus{outline:none;border-color:var(--cd);box-shadow:0 0 0 3px rgba(59,130,246,.1)}
        .btn{background:var(--cd);color:#fff;border:none;padding:12px 24px;border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;transition:background .2s}
        .btn:hover{background:#2563eb}.btn:disabled{background:#9ca3af;cursor:not-allowed}
        .hint{margin-top:10px;color:var(--mt);font-size:14px}
        .g{display:grid;grid-template-columns:1fr 1fr;gap:20px}.card{background:#f8fafc;border:1px solid #e2e8f0;border-radius:6px;padding:15px}
        .card h3{color:#1f2937;margin-bottom:10px;font-size:16px}.card p{color:var(--mt);font-size:14px;margin-bottom:5px}
        .pl{display:flex;gap:20px;align-items:flex-start}.lp{flex:0 0 30%;min-width:300px}.rp{flex:1 1 auto}
        .cp{background:#fff;border:1px solid var(--bd);border-radius:8px;padding:16px}.cp h4{margin:6px 0 10px;font-size:15px;color:#1f2937}
        .r{display:flex;gap:12px;align-items:center;margin:8px 0;flex-wrap:wrap}.r label{color:var(--tx);font-size:14px}
        .b{width:100%;height:260px;border:1px solid var(--bd);border-radius:8px;background:var(--bg)}
        .l{display:flex;gap:14px;align-items:center;margin:10px 0 8px;flex-wrap:wrap}.s{width:14px;height:14px;border-radius:3px;display:inline-block;margin-right:6px}
        .s.digital{background:var(--cd)}.s.analog{background:var(--ca)}.s.i2c{background:var(--ci)}.s.uart{background:var(--cu)}.s.spi{background:var(--cs)}.s.power{background:var(--cp)}.s.gnd{background:var(--cg)}
        .plist{margin-top:20px;padding:15px;background:var(--bg);border-radius:8px}.plist h4{margin:0 0 10px;font-size:15px;color:var(--tx)}
        .list{display:flex;flex-direction:column;gap:4px}
        .item{display:flex;align-items:center;padding:8px 12px;background:#fff;border-radius:6px;border-left:4px solid var(--bd);cursor:pointer;transition:all .2s}
        .item:hover{background:var(--bg)}.item.analog{border-left-color:var(--ca)}.item.digital{border-left-color:var(--cd)}.item.i2c{border-left-color:var(--ci)}.item.spi{border-left-color:var(--cs)}.item.uart{border-left-color:var(--cu)}
        .lbl{font-weight:700;min-width:40px;margin-right:12px}.role{flex:1;color:var(--tx)}.stat{font-size:.9em;color:var(--mt)}
        .btn-p{width:100%;margin-top:15px;padding:12px;background:var(--cd);color:#fff;border:none;border-radius:6px;font-weight:700;cursor:pointer}
        .btn-p:hover{background:#2563eb}
        .svg-t{font-size:9px;fill:#ffffff;dominant-baseline:middle;pointer-events:none;user-select:none}
        .selectedSquare{stroke:#1d4ed8;stroke-width:2}
        .subcard{background:#f9fafb;border:1px solid var(--bd);border-radius:8px;padding:12px;margin-top:8px}
        .subcard .r{margin:6px 0}
        .switch{display:flex;align-items:center;gap:8px}
        .busDisabled{opacity:0.45;filter:grayscale(100%)}
    </style>
    <script>
        const $=s=>document.querySelector(s[0]=='#'?s:'#'+s);
        const pcfg={}; let cur=''; let caps=null; const prect={}; const FC={DIGITAL:'#3B82F6',ANALOG:'#EC4899',I2C:'#10B981',UART:'#6B7280',SPI:'#8B5CF6',POWER:'#EF4444',GND:'#000'};
        const busStates={I2C:false,SPI:false,UART_TX:false,UART_RX:false};
        
        function labelsForBus(bus){
            if(bus==='I2C') return ['SDA','SCL','D4','D5'];
            if(bus==='SPI') return ['MOSI','MISO','SCK','D10','D9','D8'];
            if(bus==='UART') return ['TX','D6']; // TX et D6 sont liés
            if(bus==='UART_RX') return ['RX','D7']; // RX et D7 sont liés
            return [];
        }
        
        function updateBusVisuals(){
            // Réinitialiser tous les états visuels
            Object.keys(prect).forEach(lbl=>{
                const r = prect[lbl];
                if(!r) return;
                r.classList.remove('busDisabled');
                delete r.dataset.bus;
            });
            
            // I2C : griser SDA, SCL, D4, D5 quand I2C est actif
            if(busStates.I2C){
                ['SDA','SCL','D4','D5'].forEach(lbl=>{
                    const r = prect[lbl];
                    if(!r) return;
                    r.classList.add('busDisabled');
                    r.dataset.bus = 'I2C';
                });
            }
            
            // SPI : griser MOSI, MISO, SCK, D10, D9, D8 quand SPI est actif
            if(busStates.SPI){
                ['MOSI','MISO','SCK','D10','D9','D8'].forEach(lbl=>{
                    const r = prect[lbl];
                    if(!r) return;
                    r.classList.add('busDisabled');
                    r.dataset.bus = 'SPI';
                });
            }
            
            // UART TX : griser TX et D6 quand UART_TX est actif
            if(busStates.UART_TX){
                ['TX','D6'].forEach(lbl=>{
                    const r = prect[lbl];
                    if(!r) return;
                    r.classList.add('busDisabled');
                    r.dataset.bus = 'UART_TX';
                });
            }
            
            // UART RX : griser RX et D7 quand UART_RX est actif
            if(busStates.UART_RX){
                ['RX','D7'].forEach(lbl=>{
                    const r = prect[lbl];
                    if(!r) return;
                    r.classList.add('busDisabled');
                    r.dataset.bus = 'UART_RX';
                });
            }
        }
        
        function initTabs(){ document.querySelectorAll('.tab').forEach(t=>{ t.onclick=()=>{ document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); document.querySelectorAll('.p').forEach(p=>p.classList.remove('active')); t.classList.add('active'); $(`panel-${t.dataset.t}`).classList.add('active'); }; }); }
        
        async function loadStatus(){ const r=await fetch('/api/status'); const d=await r.json(); $('#apSsid').textContent=d.ap_ssid; $('#apIp').textContent=d.ap_ip; $('#staSsid').textContent=d.sta_ssid; $('#staIp').textContent=d.sta_ip; const s=$('#staStatus'); s.textContent=d.sta_connected?'Connecté':'Déconnecté'; s.style.color=d.sta_connected?'#059669':'#dc2626'; }
        
        async function loadMdns(){ const r=await fetch('/api/mdns/status'); const d=await r.json(); $('#mdnsName').value=d.name; }
        
        async function loadCaps(){ const r=await fetch('/api/pins/caps'); caps=await r.json(); drawBoard(); }
        
        const LAY=[{name:'5V',side:'right',row:0,type:'POWER',clickable:false},{name:'GND',side:'right',row:1,type:'GND',clickable:false},{name:'3V3',side:'right',row:2,type:'POWER',clickable:false},{name:'D0',side:'left',row:0,type:'ANALOG',typeLabel:'A0'},{name:'D1',side:'left',row:1,type:'ANALOG',typeLabel:'A1'},{name:'D2',side:'left',row:2,type:'ANALOG',typeLabel:'A2'},{name:'D3',side:'left',row:3,type:'ANALOG',typeLabel:'A3'},{name:'D4',side:'left',row:4,type:'I2C',typeLabel:'SDA'},{name:'D5',side:'left',row:5,type:'I2C',typeLabel:'SCL'},{name:'D6',side:'left',row:6,type:'UART',typeLabel:'TX'},{name:'D10',side:'right',row:3,type:'SPI',typeLabel:'MOSI'},{name:'D9',side:'right',row:4,type:'SPI',typeLabel:'MISO'},{name:'D8',side:'right',row:5,type:'SPI',typeLabel:'SCK'},{name:'D7',side:'right',row:6,type:'UART',typeLabel:'RX'}];
        
        function drawBoard(){ const L=$('#pinsLeft'),R=$('#pinsRight'); if(!L||!R)return; L.innerHTML=''; R.innerHTML=''; const RH=28; const COL={c1:20,c2:68,c4:238,c5:286}; const W=44,H=20;
            const mk=(x,y,w,h,fill,stroke,label,clk=true)=>{ const g=document.createElementNS('http://www.w3.org/2000/svg','g'); const r=document.createElementNS('http://www.w3.org/2000/svg','rect'); r.setAttribute('x',x); r.setAttribute('y',y); r.setAttribute('width',w); r.setAttribute('height',h); r.setAttribute('rx','4'); r.setAttribute('fill',fill); r.setAttribute('stroke',stroke); g.appendChild(r); const t=document.createElementNS('http://www.w3.org/2000/svg','text'); t.setAttribute('x',x+w/2); t.setAttribute('y',y+h/2+1); t.setAttribute('text-anchor','middle'); t.setAttribute('class','svg-t'); t.textContent=label; g.appendChild(t); if(clk){ g.style.cursor='pointer'; r.dataset.label=label; prect[label]=r; r.addEventListener('click',()=>{ if(cur){ pcfg[cur]=readCfg(); } if(window._selRect) window._selRect.classList.remove('selectedSquare'); window._selRect=r; r.classList.add('selectedSquare'); cur=label; $('#selPin').textContent=label; handleBusClick(label); updFunc(label); if(pcfg[cur]) applyCfg(pcfg[cur]); if(!['SDA','SCL','MOSI','MISO','SCK','TX','RX','D4','D5','D8','D9','D10','D6','D7'].includes(label)) saveCurrentPin(); }); } return g; };
            const left=(row,tl,tc,dl)=>{ const y=30+row*RH; const f=document.createDocumentFragment(); f.appendChild(mk(COL.c1,y-10,W,H,tc,'#9ca3af',tl,true)); f.appendChild(mk(COL.c2,y-10,W,H,FC.DIGITAL,'#9ca3af',dl,true)); L.appendChild(f); };
            const rightPow=(row,label,color)=>{ const y=30+row*RH; R.appendChild(mk(COL.c4,y-10,W,H,color,'#9ca3af',label,false)); };
            const right=(row,dl,tl,tc)=>{ const y=30+row*RH; const f=document.createDocumentFragment(); f.appendChild(mk(COL.c4,y-10,W,H,FC.DIGITAL,'#9ca3af',dl,true)); f.appendChild(mk(COL.c5,y-10,W,H,tc,'#9ca3af',tl,true)); R.appendChild(f); };
            left(0,'A0',FC.ANALOG,'D0'); left(1,'A1',FC.ANALOG,'D1'); left(2,'A2',FC.ANALOG,'D2'); left(3,'A3',FC.ANALOG,'D3'); left(4,'SDA',FC.I2C,'D4'); left(5,'SCL',FC.I2C,'D5'); left(6,'TX',FC.UART,'D6'); rightPow(0,'5V',FC.POWER); rightPow(1,'GND',FC.GND); rightPow(2,'3V3',FC.POWER); right(3,'D10','MOSI',FC.SPI); right(4,'D9','MISO',FC.SPI); right(5,'D8','SCK',FC.SPI); right(6,'D7','RX',FC.UART);
        }
        
        function pType(lbl){ 
            if(lbl.startsWith('A')||['D0','D1','D2','D3'].includes(lbl)) return 'analog'; 
            if(['SDA','SCL','I2C'].includes(lbl)) return 'i2c'; 
            if(['MOSI','MISO','SCK','SPI'].includes(lbl)) return 'spi'; 
            if(['TX','RX'].includes(lbl)) return 'uart'; 
            return 'digital'; 
        }
        function stat(cfg, pinLabel){ 
            if(cfg.role==='Potentiomètre') return cfg.rtpEnabled ? `CC#${cfg.rtpCc||7}` : 'Raw';
            if(cfg.role==='Bouton') return cfg.rtpEnabled ? `Note ${cfg.rtpNote||60}` : 'Digital';
            if(cfg.role==='LED') return cfg.ledMode==='pwm' ? 'PWM' : 'On/Off';
            if(cfg.role==='I2C') return 'I2C';
            if(cfg.role==='SPI') return 'SPI';
            if(cfg.role==='UART') return pinLabel?.includes('TX') ? 'TX' : 'RX';
            return cfg.role||''; 
        }
        function updatePinsList(){ const pl=$('#pinsList'); if(!pl) return; pl.innerHTML=''; Object.keys(pcfg).forEach(lbl=>{ const cfg=pcfg[lbl]; if(!cfg||!cfg.role) return; const it=document.createElement('div'); it.className=`item ${pType(lbl)}`; it.innerHTML=`<span class="lbl">${lbl}</span><span class="role">${cfg.role}</span><span class="stat">${stat(cfg, lbl)}</span>`; it.onclick=()=>{ const r=prect[lbl]; if(r) r.dispatchEvent(new Event('click')); }; pl.appendChild(it); }); }
        
        function setOptions(sel,arr,pre=0){ if(!sel) return; sel.innerHTML=arr.map((o,i)=>`<option ${i===pre?'selected':''}>${o}</option>`).join(''); }
        function showRoleCards(role){ const b=$('#cardBtn'), l=$('#cardLed'), p=$('#cardPot'); if(b) b.style.display=(role==='Bouton')?'block':'none'; if(l) l.style.display=(role==='LED')?'block':'none'; if(p) p.style.display=(role==='Potentiomètre')?'block':'none'; }
        function updFunc(lbl){ const sel=$('#funcSelect'); if(!sel) return; const isI2C=(lbl==='SDA'||lbl==='SCL'); const isSPI=(lbl==='MOSI'||lbl==='MISO'||lbl==='SCK'); const isUART=(lbl==='TX'||lbl==='RX'); if(/^A\d+$/.test(lbl)){ setOptions(sel,['Potentiomètre','Analog in (raw)'],0); } else if(/^D\d+$/.test(lbl) && !isI2C && !isSPI && !isUART){ setOptions(sel,['Bouton','LED','Digital in/out'],0); } else if(isI2C){ setOptions(sel,['I2C'],0); } else if(isSPI){ setOptions(sel,['SPI'],0); } else if(isUART){ setOptions(sel,['UART'],0); } else { setOptions(sel,[],0); } showRoleCards(sel.value||''); sel.onchange=()=>{ showRoleCards(sel.value||''); if(cur){ pcfg[cur]=readCfg(); updatePinsList(); } }; }
        
        function handleBusClick(label){
            // Gestion des pins de bus (SDA, SCL, MOSI, MISO, SCK, TX, RX)
            if(label==='SDA' || label==='SCL'){
                if(busStates.I2C){
                    busStates.I2C = false;
                    updateBusVisuals();
                    delete pcfg['I2C'];
                } else {
                    busStates.I2C = true;
                    updateBusVisuals();
                    pcfg['I2C'] = {role: 'I2C', cfg: {}};
                    // Supprimer les pins digitales associées
                    delete pcfg['D4'];
                    delete pcfg['D5'];
                }
                updatePinsList();
            } else if(label==='MOSI' || label==='MISO' || label==='SCK'){
                if(busStates.SPI){
                    busStates.SPI = false;
                    updateBusVisuals();
                    delete pcfg['SPI'];
                } else {
                    busStates.SPI = true;
                    updateBusVisuals();
                    pcfg['SPI'] = {role: 'SPI', cfg: {}};
                    // Supprimer les pins digitales associées
                    delete pcfg['D10'];
                    delete pcfg['D9'];
                    delete pcfg['D8'];
                }
                updatePinsList();
            } else if(label==='TX'){
                if(busStates.UART_TX){
                    busStates.UART_TX = false;
                    updateBusVisuals();
                    delete pcfg['TX'];
                } else {
                    busStates.UART_TX = true;
                    updateBusVisuals();
                    pcfg['TX'] = {role: 'UART', cfg: {}};
                    // Supprimer la pin digitale associée
                    delete pcfg['D6'];
                }
                updatePinsList();
            } else if(label==='RX'){
                if(busStates.UART_RX){
                    busStates.UART_RX = false;
                    updateBusVisuals();
                    delete pcfg['RX'];
                } else {
                    busStates.UART_RX = true;
                    updateBusVisuals();
                    pcfg['RX'] = {role: 'UART', cfg: {}};
                    // Supprimer la pin digitale associée
                    delete pcfg['D7'];
                }
                updatePinsList();
            } else if(label==='D4' || label==='D5'){
                // Désactiver I2C si actif
                if(busStates.I2C){
                    busStates.I2C = false;
                    updateBusVisuals();
                    delete pcfg['I2C'];
                    updatePinsList();
                }
                // Ne pas sauvegarder la configuration de D4/D5 ici
                // car elles sont gérées par les bus
            } else if(label==='D8' || label==='D9' || label==='D10'){
                // Désactiver SPI si actif
                if(busStates.SPI){
                    busStates.SPI = false;
                    updateBusVisuals();
                    delete pcfg['SPI'];
                    updatePinsList();
                }
            } else if(label==='D6'){
                // Désactiver UART_TX si actif
                if(busStates.UART_TX){
                    busStates.UART_TX = false;
                    updateBusVisuals();
                    delete pcfg['TX'];
                    updatePinsList();
                }
            } else if(label==='D7'){
                // Désactiver UART_RX si actif
                if(busStates.UART_RX){
                    busStates.UART_RX = false;
                    updateBusVisuals();
                    delete pcfg['RX'];
                    updatePinsList();
                }
            } else if(label==='A0' || label==='A1' || label==='A2' || label==='A3'){
                // Désactiver le pin digital correspondant
                const dLabel = label.replace('A', 'D');
                if(pcfg[dLabel]) delete pcfg[dLabel];
                updatePinsList();
            } else if(label==='D0' || label==='D1' || label==='D2' || label==='D3'){
                // Désactiver le pin analogique correspondant
                const aLabel = label.replace('D', 'A');
                if(pcfg[aLabel]) delete pcfg[aLabel];
                updatePinsList();
            }
        }
        
        function saveCurrentPin(){
            if(cur){
                // Ne pas sauvegarder si c'est une pin de bus ou si un bus est actif
                if(['SDA','SCL','MOSI','MISO','SCK','TX','RX'].includes(cur)) return;
                if(['D4','D5'].includes(cur) && busStates.I2C) return;
                if(['D8','D9','D10'].includes(cur) && busStates.SPI) return;
                if(['D6'].includes(cur) && busStates.UART_TX) return;
                if(['D7'].includes(cur) && busStates.UART_RX) return;
                
                pcfg[cur] = readCfg();
                updatePinsList();
            }
        }
        
        function readCfg(){ const c={}; c.role=$('#funcSelect')?.value||''; c.btnMode=$('#btnMode')?.value||''; c.ledMode=$('#ledMode')?.value||''; c.potFilter=$('#potFilter')?.value||''; c.rtpEnabled=!!$('#rtpEnabled2')?.checked; c.rtpType=$('#rtpMsgType')?.value||''; c.rtpNote=$('#rtpNote')?.value||''; c.rtpCc=$('#rtpCc')?.value||''; c.rtpChan=$('#rtpChan')?.value||''; c.oscEnabled=!!$('#oscEnabled2')?.checked; c.oscAddress=$('#oscAddress')?.value||''; c.dbgEnabled=!!$('#dbgEnabled')?.checked; c.dbgHeader=$('#dbgHeader')?.value||''; return c; }
        function applyCfg(c){ if(!c) return; const setV=(id,v)=>{ const el=$(id); if(el&&v!=null) el.value=v; }; const setC=(id,b)=>{ const el=$(id); if(el) el.checked=!!b; }; setV('funcSelect',c.role); showRoleCards(c.role); setV('btnMode',c.btnMode); setV('ledMode',c.ledMode); setV('potFilter',c.potFilter); setC('rtpEnabled2',c.rtpEnabled); setV('rtpMsgType',c.rtpType); setV('rtpNote',c.rtpNote); setV('rtpCc',c.rtpCc); setV('rtpChan',c.rtpChan); setC('oscEnabled2',c.oscEnabled); setV('oscAddress',c.oscAddress); setC('dbgEnabled',c.dbgEnabled); setV('dbgHeader',c.dbgHeader); }
        
        async function saveAll(){ const msg=$('#saveAllMsg'); msg.textContent='Enregistrement...'; try{ const ps=Object.keys(pcfg).map(async lbl=>{ const c=pcfg[lbl]; if(!c||!c.role) return; const p=new URLSearchParams(); p.set('pinLabel',lbl); p.set('role',c.role); if(c.rtpEnabled) p.set('rtpEnabled','true'); if(c.rtpType) p.set('rtpType',c.rtpType); if(c.rtpNote) p.set('rtpNote',c.rtpNote); if(c.rtpCc) p.set('rtpCc',c.rtpCc); if(c.rtpChan) p.set('rtpChan',c.rtpChan); if(c.ledMode) p.set('ledMode',c.ledMode); return fetch('/api/pins/set',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:p.toString()}); }); await Promise.all(ps); msg.textContent='Toutes les configurations enregistrées'; msg.style.color='#10b981'; }catch(e){ msg.textContent='Erreur lors de l\'enregistrement'; msg.style.color='#ef4444'; } }
        
        window.addEventListener('load',()=>{ initTabs(); loadStatus(); loadMdns(); loadCaps(); const btn=$('#saveAllBtn'); if(btn) btn.onclick=saveAll; 
            /* Brancher les changements pour mise à jour liste */
            const fieldsToWatch=['funcSelect','btnMode','ledMode','potFilter','rtpEnabled2','rtpMsgType','rtpNote','rtpCc','rtpChan','oscEnabled2','oscAddress','dbgEnabled','dbgHeader'];
            fieldsToWatch.forEach(id=>{
                const el=document.getElementById(id);
                if(el){
                    el.addEventListener('change',()=>{ if(cur){ pcfg[cur]=readCfg(); updatePinsList(); } });
                    el.addEventListener('input',()=>{ if(cur){ pcfg[cur]=readCfg(); updatePinsList(); } });
                }
            });
        });
    </script>
</head>
<body>
    <div class="c">
        <div class="h"><h1>ESP32 Server</h1><p>Configuration Wi‑Fi, RTP‑MIDI et OSC</p></div>
        <div class="t"><div class="tab active" data-t="status">Statut</div><div class="tab" data-t="connection">Connection</div><div class="tab" data-t="pins">Pins</div></div>
        <div class="p active" id="panel-status">
            <div class="g"><div class="card"><h3>Access Point</h3><p><strong>SSID:</strong> <span id="apSsid">-</span></p><p><strong>IP:</strong> <span id="apIp">-</span></p></div><div class="card"><h3>Station Wi‑Fi</h3><p><strong>SSID:</strong> <span id="staSsid">-</span></p><p><strong>IP:</strong> <span id="staIp">-</span></p><p><strong>Statut:</strong> <span id="staStatus">-</span></p></div></div>
        </div>
        <div class="p" id="panel-connection">
            <div class="f"><h3>Serveur</h3><form id="mdns"><div class="f"><label for="mdnsName">Nom du serveur</label><input type="text" id="mdnsName" placeholder="esp32rtpmidi" required><div class="hint"><small>Ce nom sera utilisé pour l'AP Wi‑Fi et http://nom.local</small></div></div><button type="submit" class="btn">Enregistrer</button><div class="hint" id="mdnsMsg"></div></form></div>
            <div class="f"><h3>OSC</h3><form id="osc"><div class="f"><label for="oscTarget">Destination</label><select id="oscTarget"><option value="ap">AP (192.168.4.1)</option><option value="sta" id="oscStaOption">STA</option></select></div><div class="f"><label for="oscPort">Port</label><input type="number" id="oscPort" value="8000" min="1024" max="65535" required></div><button type="submit" class="btn">Enregistrer</button><div class="hint" id="oscMsg"></div></form></div>
            <div class="f"><h3>Wi‑Fi Station</h3><form id="sta"><div class="f"><label for="ssid">SSID</label><input type="text" id="ssid" placeholder="Nom du réseau" required></div><div class="f"><label for="pass">Mot de passe</label><input type="password" id="pass" placeholder="Mot de passe"></div><button type="submit" class="btn">Connecter</button><div class="hint" id="staMsg"></div></form></div>
        </div>
        <div class="p" id="panel-pins">
            <div class="pl">
                <div class="lp">
                    <h3 id="boardName">ESP32‑C3</h3>
                    <div class="l"><span class="s digital"></span> Digital <span class="s analog"></span> Analog <span class="s i2c"></span> I2C <span class="s uart"></span> UART <span class="s spi"></span> SPI <span class="s power"></span> Power <span class="s gnd"></span> GND</div>
                    <svg class="b" viewBox="50 -20 260 260"><rect x="114" y="20" width="122" height="188" rx="10" fill="#ffffff" stroke="#9ca3af"/><text x="174" y="114" text-anchor="middle" font-size="12" fill="#6b7280">MCU</text><rect x="144" y="2" width="60" height="60" rx="6" fill="#e5e7eb" stroke="#9ca3af"/><g id="pinsLeft"></g><g id="pinsRight"></g></svg>
                    <div class="plist"><h4>Pins configurées</h4><div id="pinsList" class="list"></div><button id="saveAllBtn" class="btn-p">Enregistrer tout</button><div id="saveAllMsg" class="hint"></div></div>
                </div>
                <div class="rp"><div class="cp">
                    <h4>Fonction du pin</h4>
                    <div class="r"><label>Pin:</label><span id="selPin">-</span><select id="funcSelect"></select></div>
                    <div id="cardBtn" class="subcard" style="display:none;"><div class="r"><label>Mode bouton:</label><select id="btnMode"><option value="pulse">Push</option><option value="press_release">Press/Release</option><option value="toggle">Toggle</option></select></div></div>
                    <div id="cardLed" class="subcard" style="display:none;"><div class="r"><label>LED:</label><select id="ledMode"><option value="onoff">On/Off</option><option value="pwm">PWM</option></select></div></div>
                    <div id="cardPot" class="subcard" style="display:none;"><div class="r"><label>Filtre:</label><select id="potFilter"><option value="none">Aucun</option><option value="lowpass">Passe-bas</option><option value="median">Médiane</option></select></div></div>
                    <h4>RTP‑MIDI</h4>
                    <div class="r switch"><input type="checkbox" id="rtpEnabled2"><label for="rtpEnabled2">Activer</label><label>Type:</label><select id="rtpMsgType"><option>Note</option><option>Control Change</option><option>Program Change</option><option>Pitch Bend</option></select></div>
                    <div class="r"><label>Note:</label><input type="number" id="rtpNote" min="0" max="127" placeholder="60" style="width:90px;"><label>CC#:</label><input type="number" id="rtpCc" min="0" max="127" placeholder="7" style="width:90px;"><label>Ch:</label><input type="number" id="rtpChan" min="1" max="16" placeholder="1" style="width:90px;"></div>
                    <h4>OSC</h4>
                    <div class="r switch"><input type="checkbox" id="oscEnabled2"><label for="oscEnabled2">Activer</label><label>Addr:</label><input type="text" id="oscAddress" placeholder="/ctl"></div>
                    <h4>Debug</h4>
                    <div class="r switch"><input type="checkbox" id="dbgEnabled"><label for="dbgEnabled">Activer</label><label>Hdr:</label><input type="text" id="dbgHeader" placeholder="[DBG]"></div>
                </div></div>
            </div>
        </div>
    </div>
</body>
</html>